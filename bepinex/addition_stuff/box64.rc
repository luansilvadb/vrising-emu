# =============================================================================
# Box64 Configuration for V Rising with BepInEx
# =============================================================================
# This file is loaded at server startup to configure Box64 dynarec
# Place in: BepInEx/addition_stuff/box64.rc
#
# WARNING: These are PERFORMANCE settings that may cause instability!
# For maximum stability, use the DEFAULT emulators.rc settings instead.
#
# tsx-cloud STABILITY settings (default in /emulators.rc):
#   BOX64_DYNAREC_STRONGMEM=1
#   BOX64_DYNAREC_BIGBLOCK=0
#
# Documentation: https://github.com/ptitSeb/box64/blob/main/docs/USAGE.md
# =============================================================================

# -----------------------------------------------------------------------------
# V Rising Server - PERFORMANCE Configuration
# Use at your own risk - may cause crashes on some ARM64 systems
# -----------------------------------------------------------------------------
[VRisingServer.exe]

# Enable dynamic recompilation (essential for performance)
BOX64_DYNAREC=1

# Use larger recompilation blocks (PERFORMANCE, less stable)
# tsx-cloud uses 0 for stability
BOX64_DYNAREC_BIGBLOCK=2

# Fast floating point rounding
BOX64_DYNAREC_FASTROUND=1

# Fast NaN handling
BOX64_DYNAREC_FASTNAN=1

# Reduce safety flag checks (PERFORMANCE, less stable)
# tsx-cloud uses 1 for stability  
BOX64_DYNAREC_SAFEFLAGS=0

# Memory ordering - 0=relaxed (faster), 1=strong (stable)
# tsx-cloud uses 1 for stability
BOX64_DYNAREC_STRONGMEM=0

# Enable bleeding edge optimizations
BOX64_DYNAREC_BLEEDING_EDGE=1

# Memory allocation optimization
BOX64_MALLOC_HACK=1

# Suppress Box64 startup banner
BOX64_NOBANNER=1

# Disable logging for production
BOX64_LOG=0

# -----------------------------------------------------------------------------
# BepInEx / Il2CppInterop - STABILITY Configuration
# These need stable settings to avoid crashes during assembly generation
# -----------------------------------------------------------------------------
[Il2CppInterop.Generator.exe]
BOX64_DYNAREC=1
BOX64_DYNAREC_BIGBLOCK=0
BOX64_DYNAREC_SAFEFLAGS=2
BOX64_DYNAREC_STRONGMEM=1

[Cpp2IL.exe]
BOX64_DYNAREC=1
BOX64_DYNAREC_BIGBLOCK=0
BOX64_DYNAREC_SAFEFLAGS=2
BOX64_DYNAREC_STRONGMEM=1

# -----------------------------------------------------------------------------
# How to use this file:
# -----------------------------------------------------------------------------
# OPTION 1 - Maximum Stability (Recommended for new setups):
#   Leave /emulators.rc with default tsx-cloud settings
#   Don't modify this file
#
# OPTION 2 - Performance tuning:
#   Place this file in: /mnt/vrising/server/BepInEx/addition_stuff/box64.rc
#   The entrypoint.sh will load it automatically
#   Monitor for crashes and adjust as needed
#
# If you experience crashes:
#   - Set BOX64_DYNAREC_STRONGMEM=1
#   - Set BOX64_DYNAREC_BIGBLOCK=0
#   - Set BOX64_DYNAREC_SAFEFLAGS=1
# -----------------------------------------------------------------------------
